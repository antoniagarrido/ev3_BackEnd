{% extends 'base.html' %}

{% block content %}
<div class="card">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 10px;">
    <h1>Historial de Consultas</h1>
    <div>
      <a href="{% url 'exportar_consultas' %}?q={{ q|default:'' }}" class="btn">Exportar a Excel</a>
      <a href="{% url 'exportar_consultas_pdf' %}?q={{ q|default:'' }}" class="btn">Exportar a PDF</a>
      {% if user.is_staff %}
      <a href="{% url 'consulta_create' %}" class="btn btn-primary">Registrar Consulta</a>
      {% endif %}
    </div>
  </div>

  <form method="get" class="search-form">
    <input type="text" name="q" value="{{ q|default:'' }}" placeholder="Buscar por mascota, motivo o diagnóstico...">
    <button type="submit" class="btn">Buscar</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Mascota</th>
        <th>Motivo</th>
        <th>Diagnóstico</th>
        {% if user.is_staff %}
        <th>Acciones</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for consulta in page_obj %}
      <tr>
        <td>{{ consulta.fecha|date:"Y-m-d H:i" }}</td>
        <td>{{ consulta.mascota.nombre }}</td>
        <td>{{ consulta.motivo|truncatewords:10 }}</td>
        <td>{{ consulta.diagnostico|truncatewords:10 }}</td>
        {% if user.is_staff %}
        <td>
          <a href="{% url 'consulta_edit' consulta.pk %}" class="btn">Editar</a>
          <a href="{% url 'consulta_delete' consulta.pk %}" class="btn">Eliminar</a>
        </td>
        {% endif %}
      </tr>
      {% empty %}
      <tr>
        <td colspan="5">No hay consultas registradas.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% include 'paginator.html' %}
</div>
{% endblock %}